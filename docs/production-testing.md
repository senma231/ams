# 生产环境测试指南

本文档提供了在本地进行生产环境测试的步骤和最佳实践。

## 为什么需要生产环境测试？

在将应用程序部署到实际生产环境之前，在本地模拟生产环境进行测试可以帮助我们：

1. 验证构建过程是否正确
2. 确保应用程序在生产模式下正常运行
3. 检查性能和资源使用情况
4. 发现开发环境中可能被忽略的问题

## 前端生产环境测试

### 1. 构建前端应用

```bash
# 进入前端目录
cd frontend

# 安装依赖（如果尚未安装）
npm install

# 构建生产版本
npm run build
```

构建完成后，`dist` 目录中将包含所有静态文件。

### 2. 使用静态文件服务器预览

```bash
# 安装静态文件服务器（如果尚未安装）
npm install -g serve

# 启动静态文件服务器
serve -s dist
```

现在，您可以通过浏览器访问 http://localhost:5000 来预览生产版本的前端应用。

### 3. 检查前端生产构建

在预览过程中，请检查以下内容：

- 所有页面是否正常加载
- 所有功能是否正常工作
- 控制台中是否有错误或警告
- 资源加载是否正常（CSS、JavaScript、图片等）
- 响应式设计是否正常工作

## 后端生产环境测试

### 1. 设置生产环境变量

```bash
# 进入后端目录
cd backend

# 设置 NODE_ENV 环境变量
# Windows
set NODE_ENV=production

# Linux/macOS
export NODE_ENV=production
```

### 2. 启动后端服务

```bash
# 安装依赖（如果尚未安装）
npm install

# 启动后端服务
node src/app.js
```

### 3. 检查后端生产模式

在后端服务运行时，请检查以下内容：

- 服务器是否正常启动
- 日志输出是否符合预期（生产模式下通常会减少日志输出）
- API 端点是否正常响应
- 错误处理是否正确

## 前后端集成测试

### 1. 配置前端 API 地址

确保前端构建使用正确的后端 API 地址。在 `frontend/.env.production` 文件中设置：

```
VITE_API_BASE_URL=http://localhost:3000
```

### 2. 同时运行前端和后端

```bash
# 终端 1：启动后端
cd backend
set NODE_ENV=production  # Windows
node src/app.js

# 终端 2：启动前端静态服务器
cd frontend
serve -s dist
```

### 3. 进行端到端测试

使用浏览器访问前端应用（http://localhost:5000），并执行以下测试：

1. **用户认证**：
   - 登录和登出功能
   - 权限控制

2. **资产管理**：
   - 资产入库
   - 资产出库
   - 资产回收
   - 资产报废

3. **数据统计**：
   - Dashboard 数据加载
   - 图表显示
   - 操作记录显示

4. **系统设置**：
   - 用户管理
   - 资产类型维护
   - 数据备份

## 性能测试

### 1. 页面加载性能

使用浏览器开发工具的 Performance 和 Network 面板检查：

- 页面加载时间
- 资源加载时间
- JavaScript 执行时间
- 渲染时间

### 2. API 响应性能

使用工具如 Apache Bench 或 Postman 测试 API 端点的响应时间：

```bash
# 使用 Apache Bench 测试 API 响应时间
ab -n 100 -c 10 http://localhost:3000/api/assets
```

### 3. 数据库性能

测试大量数据下的查询性能：

- 添加大量测试数据
- 测试列表页面的加载时间
- 测试搜索和筛选功能的响应时间

## 安全测试

### 1. 认证和授权

- 测试未授权访问保护的路由
- 测试不同角色的权限控制
- 测试 JWT 令牌过期处理

### 2. 数据验证

- 测试表单验证
- 测试 API 输入验证
- 测试 SQL 注入防护

## 常见问题和解决方案

### 1. 前端资源路径问题

**问题**：在生产构建中，静态资源路径可能不正确。

**解决方案**：
- 检查 `vite.config.js` 中的 `base` 配置
- 确保所有资源使用相对路径或正确的绝对路径

### 2. API 连接问题

**问题**：前端无法连接到后端 API。

**解决方案**：
- 检查 API 基础 URL 配置
- 确保 CORS 设置正确
- 检查网络请求是否有错误

### 3. 环境变量问题

**问题**：环境变量未正确加载。

**解决方案**：
- 检查环境变量文件（`.env.production`）
- 确保环境变量前缀正确（Vite 使用 `VITE_` 前缀）
- 检查环境变量是否在构建时正确注入

## 测试清单

使用以下清单确保您已完成所有必要的测试：

- [ ] 前端生产构建成功
- [ ] 后端在生产模式下启动成功
- [ ] 所有页面正常加载
- [ ] 所有功能正常工作
- [ ] 用户认证和授权正常
- [ ] 资产管理功能正常
- [ ] Dashboard 数据正确显示
- [ ] 系统设置功能正常
- [ ] 页面加载性能符合要求
- [ ] API 响应性能符合要求
- [ ] 数据库性能符合要求
- [ ] 安全测试通过
- [ ] 没有控制台错误或警告
- [ ] 响应式设计在不同设备上正常工作
